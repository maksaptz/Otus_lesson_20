# Фильтрация трафика - firewalld, iptables 

Описание домашнего задания:
- настраивать файрвалл с использованием iptables/firewalld;
- настраивать NAT;
- пробрасывать порты;
- настраивать взаимодействие с роутингом;
- понимать работу таблиц и цепочек.

## Задачи домашнего задания:


1) реализовать knocking port;
2) centralRouter может попасть на ssh inetrRouter через knock скрипт;
3) добавить inetRouter2, который виден(маршрутизируется (host-only тип сети для виртуалки)) с хоста или форвардится порт через локалхост;
4) запустить nginx на centralServer;
5) пробросить 80й порт на inetRouter2 8080;
6) дефолт в инет оставить через inetRouter;


### Описание домашнего задания

Для выполнения домашнего задания будем испольовать следующий стенд: https://github.com/maksaptz/Otus_lesson_18


1) Для начало закомментируем в Vagrantfile и ansible/host лишние хосты, а также добавим новый хост inetRouter2. т.к. inetRouter2 должен состоять в сети Inet — central (192.168.255.0/30), нам придется изменить маску сети на 192.168.255.0/29, и добавить новый  ip 192.168.255.3. Дополнительно настроим проброс порта 8080 inetRouter2 на машину хост vagrant;
2) В роли ansible firewall меняем задачу которая настраивает iptables inetRouter, и добавляем в нее knock knock правила;
3) Добавляем роль ansible knock, которая добавит скрипт для доступа по ssh и установит nmap на centralServer, а также внесет изменения в конфиг ssh inetRouter, чтобы root мог подключиться по ssh паролю;
4) Добавим роль в ansible nginx, которая установит nginx на centralServer;
5) В роли firefall добавляем таску которая настроит в iptables dst-nat и  src-nat на inetRouter2 которые будут пробрасывать порт 8080 на 80 порт centralServer.


#### Проверка дз
1) Для проверки домашнего задания заходим на centralServer и пробуем зайти на inetRouter ```ssh root@192.168.255.1``` Видим что порт закрыт. Применяем скрипт ```/home/vagrant/knock.sh 192.168.255.1 8881 7777 9991``` и в течении 30 секунд пробуем зайти снова(pass: vagrant). Вуаля доступ есть.
##### ansible на таске reboot inetRouter зависает т.к. применяются правила iptables, просто пропускаем данный момент ctrl+c
3) В хостовой виртуальной машине проходим по ```http://127.0.0.1:8080/``` Видим что проброс портов работает.
